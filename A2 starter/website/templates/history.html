{% extends "base.html" %}

{% block title %}Booking History{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='Style/BookingHistoryStyle.css') }}">
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="d-flex justify-content-center">
        <ul class="nav nav-tabs nav-fill mb-0" style="max-width: 700px; width: 100%;" id="bookingTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="past-bookings-tab" data-bs-toggle="tab" data-bs-target="#past-bookings" type="button" role="tab" aria-controls="past-bookings" aria-selected="true">
                    History
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="your-events-tab" data-bs-toggle="tab" data-bs-target="#your-events" type="button" role="tab" aria-controls="your-events" aria-selected="false">
                    Your Events
                </button>
            </li>
        </ul>
    </div>
    <!-- Tabs Content -->
    <div class="tab-content" id="bookingTabsContent" style="min-height: 500px">
        <!-- Past Bookings Tab -->
        <div class="tab-pane fade show active" id="past-bookings" role="tabpanel" aria-labelledby="past-bookings-tab">
            <div class="d-flex justify-content-center">
                <div class="card p-4 mb-5" style="max-width: 700px; width: 100%; border: #cd98fb solid 2px; border-radius: 0 0 15px 15px; border-width: 0 2px 2px 2px">
                    <h2 class="text-center m-0">Your Booking History</h2>
                    <p class="text-black text-center mb-4">Manage and view your past bookings here</p>
                    
                    <!-- User's Actual Bookings from Database -->
                    {% for order in user_orders %}
                    <div class="card mb-3" style="border-radius:20px; overflow: hidden; border: #cd98fb solid 1px;  height: 150px">
                        <div class="row g-0 flex-column flex-md-row">
                            <!-- Event image -->
                            <div class="col-md-4">
                                <a href="{{ url_for('main.order_details', order_id=order.orderid) }}" class="h-100 d-block">
                                    <img src="{{ order.event.image }}" class="booking-img" style="width: 100%; height: 100%; object-fit: cover; min-height: 150px;">
                                </a>
                            </div>
                            <!-- Booking details -->
                            <div class="col-md-8">
                                <div class="card-body d-flex flex-column justify-content-between h-100">
                                    <div>
                                        <h5 class="card-title">{{ order.event.title }}</h5>
                                        <p class="card-text mb-1"><strong>Booking ID:</strong> #{{ "%06d"|format(order.orderid) }}</p>
                                        <p class="card-text mb-1"><strong>Date Booked:</strong> {{ order.timeBooked.strftime('%d/%m/%Y') }}</p>
                                        <p class="card-text mb-1"><strong>Total:</strong> ${{ "%.2f"|format(order.totalPrice) }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <!-- No bookings message -->
                    <div class="text-center py-4">
                        <p class="text-muted">You haven't made any bookings yet.</p>
                        <a href="{{ url_for('main.index') }}" class="btn btn-success">Browse Events</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- Your Events Tab -->
        <div class="tab-pane fade" id="your-events" role="tabpanel" aria-labelledby="your-events-tab">
            <div class="d-flex justify-content-center">
                <div class="card p-4 MB-5" style="min-height: 500px; max-width: 700px; width: 100%; border: #cd98fb solid 2px; border-radius: 0 0 15px 15px; border-width: 0 2px 2px 2px">
                    <h2 class="text-center mb-0">Your Created Events</h2>
                    <p class="text-black text-center mb-4">Manage and edit your events here</p>
                    <!-- Database Events (User's Events) -->
                    {% for event in user_events %}
                    <div class="card mb-3" style="border: #cd98fb solid 1px; overflow: hidden; border-radius: 10px;">
                        <div class="row g-0 flex-column flex-md-row">
                            <!-- Event image - Fixed 150px height -->
                            <div class="col-md-4" style="height: 150px;">
                                <a href="{{ url_for('main.event_detail', event_id=event.eventid) }}" class="h-100 d-block">
                                    <img src="{{ event.image }}" class="h-100 w-100" style="object-fit: cover;">
                                </a>
                            </div>
                            <!-- Event details -->
                            <div class="col-md-8">
                                <div class="card-body d-flex flex-column justify-content-between" style="min-height: 150px;">
                                    <div>
                                        <h5 class="card-title">{{ event.title }}</h5>
                                        <p class="card-text mb-1"><strong>Location:</strong> {{ event.location }}, {{ event.country.title() }}</p>
                                        <p class="card-text mb-1"><strong>Event Date:</strong> {{ event.date.strftime('%d/%m/%Y') if event.date else 'TBA' }} {{ event.startTime.strftime('%I:%M %p') if event.startTime else 'TBA' }}</p>
                                    </div>
                                    <div class="d-flex gap-2 mt-1">
                                        <a href="{{ url_for('main.event_detail', event_id=event.eventid) }}" class="btn btn-sm flex-fill btn-purple-outline">View</a>
                                        <a href="{{ url_for('edit.edit', eventid=event.eventid) }}" class="btn btn-outline-warning btn-sm flex-fill">Edit</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <!-- Add Event Card -->
                    <div class="card mb-3" style="border: #cd98fb solid 1px; overflow: hidden">
                        <div class="row g-0 flex-column flex-md-row" style="min-height: 150px;"> 
                            <div class="col-md-4">
                                <a href="{{ url_for('create.create') }}" class="text-decoration-none h-100 d-block">
                                    <div class="d-flex justify-content-center align-items-center h-100 bg-light">
                                        <img src="{{ url_for('static', filename='Image/more.png') }}" style="height: 60px; width: 60px; object-fit: contain;">
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-8">
                                <div class="card-body d-flex flex-column justify-content-center h-100">
                                    <a href="{{ url_for('create.create') }}" class="text-decoration-none text-dark">
                                        <h5 class="card-title">Create New Event</h5>
                                        <p class="card-text text-muted">Click here to create and manage a new event</p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
